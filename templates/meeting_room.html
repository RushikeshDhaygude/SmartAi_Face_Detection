<!DOCTYPE html>
<html>
  <head>
    <title>Two Components, Left and Right</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='meeting_room.css') }}">
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        // Get the video element
        var video = document.getElementById('video');

        // Use getUserMedia API to access the webcam stream
        navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
          video.srcObject = stream;
        });

        // Set up a canvas element to capture frames from the video
        var canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        var context = canvas.getContext('2d');

        // Set up a timer to capture frames every 200ms (5 frames in 1 second)
        var interval = setInterval(function() {
          // Draw the current frame from the video to the canvas
          context.drawImage(video, 0, 0, canvas.width, canvas.height);
          // Get the base64-encoded data URL of the canvas image
          var imageDataUrl = canvas.toDataURL('image/jpeg');
          // Send the image data to the Flask backend using an AJAX request
          $.ajax({
            url: '/run_eye_tracking',
            method: 'POST',
            data: { image_data: imageDataUrl },
            success: function(response) {
              console.log(response);
            }
          });
        }, 200);

        // Stop capturing frames after 5 seconds (1000ms * 5 frames = 1000ms * 5 / 200ms = 25)
        setTimeout(function() {
          clearInterval(interval);
        }, 5000);
      });
    </script>
      
  </head>
  <body>
    <div class="container">
      <div class="left-component">
        <!-- <a href="{{ url_for('run_eye_tracking') }}">Function 1</a> -->
        <h2>Student Webcam</h2>
        <video id="video"></video>
      </div>
      <div class="right-component">
        <h2>HeatMap</h2>

      </div>
    </div>
  </body>
</html>
